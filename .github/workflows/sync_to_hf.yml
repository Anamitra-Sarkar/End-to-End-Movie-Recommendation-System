name: Sync to Hugging Face Space

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      # 2. Install Library
      - name: Install Hugging Face Hub
        run: pip install huggingface_hub

      # 3. Upload using Python API (The 100% Fail-Safe Method)
      - name: Push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        shell: python
        run: |
          from huggingface_hub import HfApi
          import os

          # Initialize API
          api = HfApi()
          token = os.environ["HF_TOKEN"]
          repo_id = "Arko007/movie-backend"

          print(f"Starting upload to {repo_id}...")

          # Upload the current folder (.) to the Repo
          api.upload_folder(
              folder_path=".",
              repo_id=repo_id,
              repo_type="space",
              token=token,
              ignore_patterns=[".git/*", ".github/*", ".gitattributes"]
          )

          print("Upload complete! ðŸš€")
